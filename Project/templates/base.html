<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Project ZetaX</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="{{ url_for('static',filename='CSS/editor-styles.css')}}">
    <link rel="stylesheet" href="{{ url_for('static',filename='CSS/style-home.css')}}">
    <link href="{{ url_for('static',filename='assets/image1.jpg')}}">
    <link href="{{ url_for('static',filename='assets/image2.jpg')}}">
    <link href="{{ url_for('static',filename='assets/image3.jpg')}}">
    <link rel="shortcut icon" type = "image/x-icon" href="{{ url_for('static',filename='assets/Icon-for-Webpages.ico')}}">
  </head>
  <body class="bg-secondary-subtle text-primary-emphasis">
    {% include 'navbar.html' %}
    <div class="container">
        {% block content %}
        {% endblock %}
    </div>
    <script 
      	src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous">
    </script>

    <!-- Required Ace Libraries -->
    <script src="{{ url_for('static',filename='src-min/ace.js')}}"></script>
    <script src="{{ url_for('static',filename='src-min/mode-c_cpp.js')}}"></script>
    <script src="{{ url_for('static',filename='src-min/ext-language_tools.js')}} "></script>
    <!-- Custom Scripts -->
    <script src = "http://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- <script src="{{ url_for('static',filename='editor.js')}}"></script> -->

    <script>
      // Retrive Elements
const run_btn = document.querySelector('.editor__run');
const reset_btn = document.querySelector('.editor__reset');
const input_btn = document.querySelector('#input_tab');
const output_btn = document.querySelector('#output_tab');
const input_textarea = document.querySelector('#input_textarea');
const output_textarea = document.querySelector('#output_textarea');

// decoder function

function b64DecodeUnicode(str) {
    // Going backwards: from bytestream, to percent-encoding, to original string.
    return decodeURIComponent(atob(str).split('').map(function(c) {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
    }).join(''));
}

// Setup Ace
let codeEditor = ace.edit("editorCode");

let defaultCode = '#include <stdio.h>\n\nint main() {\n\n    //Enter your code\n\n    return 0;\n}';

let editorLib = {
    init(){
        // Configure Ace

        // Theme
        codeEditor.setTheme("ace/theme/monokai");

        // Set langugage
        codeEditor.session.setMode("ace/mode/c_cpp");

        // Set options
        codeEditor.setOptions({
            fontSize: '14pt',
            enableBasicAutocompletion: true,
            enableLiveAutocompletion: true,
        })

        // Set default code
        codeEditor.setValue(defaultCode);
    }
}

editorLib.init();


// Events

// Run button
run_btn.addEventListener('click',async () => {
    // Get input from the code editor
    const userCode = codeEditor.getValue();
    const encoded_code = btoa(userCode);
    const stdin = input_textarea.value;
    const encoded_std = btoa(stdin);

    // Send this code to API to parse it. How exactly to do this?

    // 1. Just use judge0 -> not very impressive, doesn't require any backend work
    // 2. Create an API, use Python in backend for shell scripting, compile and send data back to the front end.

    const settings = {
        async: true,
        crossDomain: true,
        url: 'https://judge0-ce.p.rapidapi.com/submissions?base64_encoded=true&wait=true&fields=*',
        method: 'POST',
        headers: {
            'content-type': 'application/json',
            'Content-Type': 'application/json',
            'X-RapidAPI-Key': '29a58e30d8msh81af7566051cd6ep196b88jsne041a8d0a091',
            'X-RapidAPI-Host': 'judge0-ce.p.rapidapi.com'
        },
        processData: true,
        data: '{\r\n    "language_id": 50,\r\n    "source_code": "' + encoded_code + '",\r\n    "stdin": "' + encoded_std + '"\r\n}'
    };
    
    $.ajax(settings).done(function (response) {
        console.log(response);
        let stdout = response["stdout"];
        
        if(stdout!=null){
            output_textarea.value = b64DecodeUnicode(stdout);
            //console.log(b64DecodeUnicode(stdout))
        }
        else{
            output_textarea.value = b64DecodeUnicode(response["compile_output"]);
            //console.log(b64DecodeUnicode(response["compile_output"]));
        }
    });
});

// Reset Button

reset_btn.addEventListener('click',()=>{
    codeEditor.setValue(defaultCode);
});

// Input button
input_btn.addEventListener('click',()=>{
    output_btn.classList.remove("highlight_btn");
    input_btn.classList.add("highlight_btn");
    output_textarea.classList.add("hidden");
    input_textarea.classList.remove("hidden");
});

// Output button
output_btn.addEventListener('click',()=>{
    input_btn.classList.remove("highlight_btn");
    output_btn.classList.add("highlight_btn");
    input_textarea.classList.add("hidden");
    output_textarea.classList.remove("hidden");
});

    </script>
  </body>
</html>